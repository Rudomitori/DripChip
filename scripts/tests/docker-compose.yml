version: '3.9'
services:
  # db must be added by overriding with docker-compose file from "postgres" folder
  backend: # Must be overriden with docker-compose files from "backend" folder
    depends_on:
      db:
        condition: service_healthy
    ports:
      - "8080:80"
      - "8081:443"
    environment:
      ConnectionStrings__Default: Host=db;Username=postgres;Password=postgres;Database=DripChip
  tests:
    image: mrexpen/planet_olymp_phase1
    pull_policy: always
    ports:
      - "8090:8080"
    depends_on:
      backend:
        condition: service_healthy
    environment:
      - SERVER_URL=http://backend
      - STAGE=all
        # all - запуск всех тестов из трёх доступных этапов
        # 0, 1 или 2 - запуск тестов для соответствующего этапа